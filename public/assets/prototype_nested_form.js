document.observe("click",function(a,b){if(b=a.findElement("form a.add_nested_fields")){var c=b.readAttribute("data-association"),d=$(c+"_fields_blueprint").innerHTML,e=(b.getOffsetParent(".fields").firstDescendant().readAttribute("name")||"").replace(new RegExp("[[a-z]+]$"),"");if(e){var f=e.match(/[a-z_]+_attributes/g)||[],g=e.match(/(new_)?[0-9]+/g)||[];for(i=0;i<f.length;i++)g[i]&&(d=d.replace(new RegExp("(_"+f[i]+")_.+?_","g"),"$1_"+g[i]+"_"),d=d.replace(new RegExp("(\\["+f[i]+"\\])\\[.+?\\]","g"),"$1["+g[i]+"]"))}var h=new RegExp("new_"+c,"g"),j=(new Date).getTime();return d=d.replace(h,"new_"+j),b.insert({before:d}),!1}}),document.observe("click",function(a,b){if(b=a.findElement("form a.remove_nested_fields")){var c=b.previous(0);return c&&(c.value="1"),b.ancestors()[0].hide(),!1}})